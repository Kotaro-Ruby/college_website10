<% content_for :title, "#{@state_data[:name]}（#{@state_data[:english_name]}）の大学一覧・留学ガイド【#{@total_colleges}校】- College Spark" %>
<% content_for :description, "#{@state_data[:name]}（#{@state_data[:english_name]}）の大学#{@total_colleges}校を紹介。気候、生活費、文化、主要大学を詳しく解説。#{@state_data[:education_highlights]}" %>
<% content_for :keywords, "#{@state_data[:name]} 大学, #{@state_data[:english_name]} 留学, #{@state_data[:name]} 留学, アメリカ #{@state_data[:name]}, #{@state_data[:largest_city]} 大学" %>

<%# 構造化データ %>
<% content_for :head do %>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": "<%= @state_data[:name] %>の大学一覧",
  "description": "<%= @state_data[:name] %>にある<%= @total_colleges %>校の大学情報",
  "numberOfItems": <%= @total_colleges %>,
  "itemListElement": [
    <% @top_colleges.each_with_index do |college, index| %>
    {
      "@type": "ListItem",
      "position": <%= index + 1 %>,
      "item": {
        "@type": "EducationalOrganization",
        "name": "<%= college.college %>"<% if college.name_ja.present? %>,
        "alternateName": "<%= college.name_ja %>"<% end %>
      }
    }<%= ',' unless index == @top_colleges.length - 1 %>
    <% end %>
  ]
}
</script>
<% end %>

<div class="main">
  <div class="state-page">
    <!-- Breadcrumb -->
    <div class="breadcrumb-bar">
      <div class="breadcrumb-inner">
        <%= link_to states_path, class: "breadcrumb-link" do %>
          ← 州一覧に戻る
        <% end %>
      </div>
    </div>

    <!-- Header -->
    <header class="state-header">
      <div class="header-inner">
        <span class="state-code"><%= @state_code.upcase %></span>
        <h1><%= @state_data[:name] %></h1>
        <p class="english-name"><%= @state_data[:english_name] %></p>
        <p class="nickname"><%= @state_data[:nickname] %></p>
      </div>
    </header>

    <!-- Content -->
    <div class="state-body">
      <div class="state-body-inner">

        <!-- Overview -->
        <section class="overview-section">
          <p class="overview-text"><%= @state_data[:description] %></p>
        </section>

        <!-- Quick Facts -->
        <section class="facts-section">
          <h2>基本データ</h2>
          <div class="facts-table">
            <div class="fact-row">
              <span class="fact-label">州都</span>
              <span class="fact-value"><%= @state_data[:capital] %></span>
            </div>
            <div class="fact-row">
              <span class="fact-label">最大都市</span>
              <span class="fact-value"><%= @state_data[:largest_city] %></span>
            </div>
            <div class="fact-row">
              <span class="fact-label">人口</span>
              <span class="fact-value"><%= @state_data[:population] %></span>
            </div>
            <div class="fact-row">
              <span class="fact-label">面積</span>
              <span class="fact-value"><%= @state_data[:area] %></span>
            </div>
            <div class="fact-row">
              <span class="fact-label">気候</span>
              <span class="fact-value"><%= @state_data[:climate] %>（年間平均: <%= @state_data[:average_temp] %>）</span>
            </div>
            <div class="fact-row">
              <span class="fact-label">生活費</span>
              <span class="fact-value"><%= @state_data[:cost_of_living] %></span>
            </div>
            <div class="fact-row">
              <span class="fact-label">主要産業</span>
              <span class="fact-value"><%= @state_data[:economy] %></span>
            </div>
          </div>
        </section>

        <!-- Education -->
        <section class="education-section">
          <h2>教育環境</h2>
          <div class="education-content">
            <div class="education-item">
              <h3>教育の特色</h3>
              <p><%= @state_data[:education_highlights] %></p>
            </div>
            <div class="education-item">
              <h3>留学生環境</h3>
              <p><%= @state_data[:international_students] %></p>
            </div>
            <div class="education-item">
              <h3>就職機会</h3>
              <p><%= @state_data[:job_opportunities] %></p>
            </div>
          </div>
        </section>

        <!-- Colleges -->
        <section class="colleges-section">
          <div class="colleges-header">
            <h2><%= @state_data[:name] %>の大学（<%= @total_colleges %>校）</h2>
            <%= link_to "/results?state=#{@state_data[:name]}(#{@state_code})", class: "search-link" do %>
              全て見る →
            <% end %>
          </div>

          <% if @top_colleges.any? %>
            <div class="colleges-list">
              <% @top_colleges.each_with_index do |college, index| %>
                <div class="college-row">
                  <div class="college-main">
                    <span class="college-num"><%= index + 1 %></span>
                    <div class="college-details">
                      <h3><%= college.college %></h3>
                      <span class="college-type-tag"><%= college.privateorpublic == "州立" ? "Public" : college.privateorpublic == "私立" ? "Private" : college.privateorpublic %></span>
                    </div>
                  </div>
                  <div class="college-stats">
                    <div class="stat">
                      <span class="stat-val"><%= college.students ? number_with_delimiter(college.students) : "—" %></span>
                      <span class="stat-lbl">学生数</span>
                    </div>
                    <div class="stat">
                      <span class="stat-val"><%= college.acceptance_rate ? "#{(college.acceptance_rate * 100).round}%" : "—" %></span>
                      <span class="stat-lbl">合格率</span>
                    </div>
                    <div class="stat">
                      <span class="stat-val"><%= college.tuition_in_state ? "$#{number_with_delimiter(college.tuition_in_state.to_i)}" : "—" %></span>
                      <span class="stat-lbl">学費</span>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="no-data">この州の大学データは現在準備中です。</p>
          <% end %>
        </section>

      </div>
    </div>
  </div>
</div>

<style>
.state-page {
  background: #fff;
  min-height: 100vh;
}

/* Breadcrumb */
.breadcrumb-bar {
  background: #f8f8f8;
  border-bottom: 1px solid #eee;
}

.breadcrumb-inner {
  max-width: 900px;
  margin: 0 auto;
  padding: 12px 20px;
}

.breadcrumb-link {
  color: #666;
  text-decoration: none;
  font-size: 14px;
}

.breadcrumb-link:hover {
  color: #000;
}

/* Header */
.state-header {
  background: #1a1a1a;
  color: #fff;
  padding: 60px 20px;
  text-align: center;
}

.header-inner {
  max-width: 900px;
  margin: 0 auto;
}

.state-code {
  display: inline-block;
  background: rgb(200, 140, 40);
  color: #000;
  font-weight: 700;
  font-size: 13px;
  padding: 4px 12px;
  border-radius: 3px;
  margin-bottom: 16px;
  letter-spacing: 1px;
}

.state-header h1 {
  font-size: 36px;
  font-weight: 700;
  margin: 0 0 8px;
  letter-spacing: -0.5px;
}

.english-name {
  font-size: 16px;
  color: rgba(255,255,255,0.7);
  margin: 0 0 12px;
  font-weight: 400;
}

.nickname {
  font-size: 14px;
  color: rgb(200, 140, 40);
  margin: 0;
}

/* Body */
.state-body {
  background: #fff;
}

.state-body-inner {
  max-width: 900px;
  margin: 0 auto;
  padding: 40px 20px;
}

/* Overview */
.overview-section {
  margin-bottom: 48px;
}

.overview-text {
  font-size: 16px;
  line-height: 1.9;
  color: #333;
  margin: 0;
}

/* Facts */
.facts-section {
  margin-bottom: 48px;
}

.facts-section h2 {
  font-size: 20px;
  font-weight: 700;
  color: #1a1a1a;
  margin: 0 0 20px;
  padding-bottom: 12px;
  border-bottom: 2px solid #1a1a1a;
}

.facts-table {
  border: 1px solid #e5e5e5;
  border-radius: 4px;
  overflow: hidden;
}

.fact-row {
  display: flex;
  border-bottom: 1px solid #e5e5e5;
}

.fact-row:last-child {
  border-bottom: none;
}

.fact-label {
  width: 140px;
  flex-shrink: 0;
  background: #fafafa;
  padding: 14px 16px;
  font-size: 14px;
  color: #666;
  font-weight: 500;
}

.fact-value {
  flex: 1;
  padding: 14px 16px;
  font-size: 14px;
  color: #1a1a1a;
}

/* Education */
.education-section {
  margin-bottom: 48px;
}

.education-section h2 {
  font-size: 20px;
  font-weight: 700;
  color: #1a1a1a;
  margin: 0 0 20px;
  padding-bottom: 12px;
  border-bottom: 2px solid #1a1a1a;
}

.education-content {
  display: flex;
  flex-direction: column;
  gap: 24px;
}

.education-item h3 {
  font-size: 15px;
  font-weight: 600;
  color: #1a1a1a;
  margin: 0 0 8px;
}

.education-item p {
  font-size: 14px;
  line-height: 1.7;
  color: #555;
  margin: 0;
}

/* Colleges */
.colleges-section {
  margin-bottom: 40px;
}

.colleges-header {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  margin-bottom: 20px;
  padding-bottom: 12px;
  border-bottom: 2px solid #1a1a1a;
}

.colleges-header h2 {
  font-size: 20px;
  font-weight: 700;
  color: #1a1a1a;
  margin: 0;
}

.search-link {
  font-size: 14px;
  color: rgb(200, 140, 40);
  text-decoration: none;
  font-weight: 500;
}

.search-link:hover {
  text-decoration: underline;
}

.colleges-list {
  border: 1px solid #e5e5e5;
  border-radius: 4px;
  overflow: hidden;
}

.college-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  border-bottom: 1px solid #e5e5e5;
  transition: background 0.15s;
}

.college-row:last-child {
  border-bottom: none;
}

.college-row:hover {
  background: #fafafa;
}

.college-main {
  display: flex;
  align-items: center;
  gap: 16px;
}

.college-num {
  width: 28px;
  height: 28px;
  background: #1a1a1a;
  color: #fff;
  font-size: 12px;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
  flex-shrink: 0;
}

.college-details h3 {
  font-size: 15px;
  font-weight: 600;
  color: #1a1a1a;
  margin: 0 0 4px;
}

.college-type-tag {
  font-size: 11px;
  color: #888;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.college-stats {
  display: flex;
  gap: 32px;
}

.stat {
  text-align: right;
}

.stat-val {
  display: block;
  font-size: 15px;
  font-weight: 600;
  color: #1a1a1a;
}

.stat-lbl {
  font-size: 11px;
  color: #999;
}

.no-data {
  text-align: center;
  padding: 40px;
  color: #999;
}

/* Responsive */
@media (max-width: 768px) {
  .state-header {
    padding: 40px 20px;
  }

  .state-header h1 {
    font-size: 28px;
  }

  .state-body-inner {
    padding: 30px 16px;
  }

  .fact-row {
    flex-direction: column;
  }

  .fact-label {
    width: 100%;
    padding: 10px 14px;
  }

  .fact-value {
    padding: 10px 14px;
  }

  .college-row {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
    padding: 16px;
  }

  .college-stats {
    width: 100%;
    justify-content: space-between;
    padding-left: 44px;
  }

  .stat {
    text-align: left;
  }

  .colleges-header {
    flex-direction: column;
    gap: 8px;
    align-items: flex-start;
  }
}

@media (max-width: 480px) {
  .state-header h1 {
    font-size: 24px;
  }

  .college-stats {
    gap: 16px;
    flex-wrap: wrap;
  }
}
</style>
