<% content_for :title, "大学検索 - College Spark" %>
<% content_for :description, "アメリカの大学を詳細条件で検索できます。州、学費、専攻、SATスコア、学生数など様々な条件で絞り込んで、あなたにぴったりの大学を見つけましょう。" %>
<% content_for :keywords, "大学検索, アメリカ大学, 条件検索, 学費, 専攻, SATスコア, 州立大学, 私立大学, 大学選び" %>
<% content_for :og_title, "大学検索 - College Spark" %>
<% content_for :og_description, "アメリカの大学を詳細条件で検索。州、学費、専攻、SATスコア、学生数など様々な条件で絞り込んで、あなたにぴったりの大学を見つけましょう。" %>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<style>
/* ヘッダー部分の改良スタイル */
.copy-container {
    background: linear-gradient(135deg, #ffcc99 0%, #ffe0b3 50%, #fff2e6 100%);
    padding: 40px 20px 50px 20px;
    text-align: center;
    position: relative;
    overflow: hidden;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
}

.copy-container::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, transparent 70%);
    animation: rotate 30s linear infinite;
}

@keyframes rotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.copy-container h1 {
    font-family: 'Poppins', sans-serif;
    font-size: clamp(1.8rem, 4vw, 2.8rem);
    font-weight: 700;
    color: #d4621a;
    margin: 0 0 15px 0;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    position: relative;
    z-index: 2;
    letter-spacing: -0.5px;
}

.copy-container h2 {
    font-size: clamp(0.9rem, 2vw, 1.1rem);
    color: #b8621d;
    margin: 0 0 30px 0;
    font-weight: 500;
    position: relative;
    z-index: 2;
    text-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
}

.college-name-search {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(8px);
    border-radius: 16px;
    padding: 30px 25px;
    margin: 0 auto;
    max-width: 800px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    position: relative;
    z-index: 2;
    border: 1px solid rgba(255, 255, 255, 0.4);
}

.search-header {
    margin-bottom: 20px;
}

.search-header h3 {
    font-size: 1.1rem;
    font-weight: 600;
    color: #d4621a;
    margin: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.search-header i {
    font-size: 1.2rem;
    color: #cc7a3a;
}

.search-input-container {
    display: flex;
    gap: 12px;
    margin-bottom: 18px;
    align-items: stretch;
}

.college-search-input {
    flex: 1;
    padding: 15px 20px;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    font-size: 1rem;
    color: #4a5568;
    background: white;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    min-height: 50px;
}

.college-search-input:focus {
    outline: none;
    border-color: #d4621a;
    box-shadow: 0 3px 15px rgba(212, 98, 26, 0.15);
    transform: translateY(-1px);
}

.college-search-input::placeholder {
    color: #a0aec0;
    font-style: italic;
}

.name-search-btn {
    background: linear-gradient(135deg, #d4621a, #cc7a3a);
    color: white;
    border: none;
    padding: 15px 25px;
    border-radius: 12px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 4px 15px rgba(212, 98, 26, 0.2);
    white-space: nowrap;
    min-height: 50px;
}

.name-search-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(212, 98, 26, 0.3);
    background: linear-gradient(135deg, #c25818, #b86b32);
}

.name-search-btn:active {
    transform: translateY(-1px);
}

.search-separator {
    text-align: center;
}

.search-separator span {
    background: #d4621a;
    color: white;
    font-weight: 500;
    font-size: 0.9rem;
    padding: 8px 16px;
    border-radius: 15px;
    display: inline-block;
    box-shadow: 0 2px 8px rgba(212, 98, 26, 0.2);
}

/* レスポンシブ対応 */
@media (max-width: 768px) {
    .copy-container {
        padding: 30px 15px 40px 15px;
    }
    
    .college-name-search {
        padding: 25px 20px;
        margin: 0 15px;
        max-width: calc(100% - 30px);
    }
    
    .search-input-container {
        flex-direction: column;
        gap: 15px;
    }
    
    .college-search-input {
        padding: 15px 18px;
        font-size: 16px;
        min-height: 50px;
    }
    
    .name-search-btn {
        justify-content: center;
        padding: 15px 25px;
        font-size: 16px;
        min-height: 50px;
    }
}

@media (max-width: 480px) {
    .college-name-search {
        padding: 20px 15px;
        margin: 0 10px;
        max-width: calc(100% - 20px);
    }
    
    .search-header h3 {
        font-size: 1rem;
    }
}
</style>

<div class="main">
    <div class="copy-container">
        <h1>College Spark</h1>
        <h2>~条件を指定してアメリカの大学を探そう！~</h2>
        
        <!-- 大学名検索機能 -->
        <div class="college-name-search">
            <div class="search-header">
                <h3><i class="fas fa-search"></i>大学名で直接検索</h3>
            </div>
            <div class="search-input-container">
                <input type="text" id="college-name-input" placeholder="例：Harvard University, Stanford University..." class="college-search-input">
                <button id="name-search-button" class="name-search-btn">
                    <i class="fas fa-arrow-right"></i> 検索
                </button>
            </div>
            <div class="search-separator">
                <span>または</span>
            </div>
        </div>
    </div>

    <div class="contents">
        <div class="conditions1">
            <div class="box">
                <div class="line-header1">
                    <h1><i class="fas fa-map-marked-alt"></i>州</h1>
                </div>
                <select class="form-select" id="stateSelect" style="margin-top: 70px;">
                    <option value="選択してください">選択してください</option>
                    <option value="指定しない">指定しない</option>
                    <option value="アラバマ州(AL)">アラバマ州(AL)</option>
                    <option value="アラスカ州(AK)">アラスカ州(AK)</option>
                    <option value="アリゾナ州(AZ)">アリゾナ州(AZ)</option>
                    <option value="アーカンソー州(AR)">アーカンソー州(AR)</option>
                    <option value="カリフォルニア州(CA)">カリフォルニア州(CA)</option>
                    <option value="コロラド州(CO)">コロラド州(CO)</option>
                    <option value="コネチカット州(CT)">コネチカット州(CT)</option>
                    <option value="デラウェア州(DE)">デラウェア州(DE)</option>
                    <option value="コロンビア特別区(DC)">コロンビア特別区(DC)</option>
                    <option value="フロリダ州(FL)">フロリダ州(FL)</option>
                    <option value="ジョージア州(GA)">ジョージア州(GA)</option>
                    <option value="ハワイ州(HI)">ハワイ州(HI)</option>
                    <option value="アイダホ州(ID)">アイダホ州(ID)</option>
                    <option value="イリノイ州(IL)">イリノイ州(IL)</option>
                    <option value="インディアナ州(IN)">インディアナ州(IN)</option>
                    <option value="アイオワ州(IA)">アイオワ州(IA)</option>
                    <option value="カンザス州(KS)">カンザス州(KS)</option>
                    <option value="ケンタッキー州(KY)">ケンタッキー州(KY)</option>
                    <option value="ルイジアナ州(LA)">ルイジアナ州(LA)</option>
                    <option value="メイン州(ME)">メイン州(ME)</option>
                    <option value="メリーランド州(MD)">メリーランド州(MD)</option>
                    <option value="マサチューセッツ州(MA)">マサチューセッツ州(MA)</option>
                    <option value="ミシガン州(MI)">ミシガン州(MI)</option>
                    <option value="ミネソタ州(MN)">ミネソタ州(MN)</option>
                    <option value="ミシシッピ州(MS)">ミシシッピ州(MS)</option>
                    <option value="ミズーリ州(MO)">ミズーリ州(MO)</option>
                    <option value="モンタナ州(MT)">モンタナ州(MT)</option>
                    <option value="ネブラスカ州(NE)">ネブラスカ州(NE)</option>
                    <option value="ネバダ州(NV)">ネバダ州(NV)</option>
                    <option value="ニューハンプシャー州(NH)">ニューハンプシャー州(NH)</option>
                    <option value="ニュージャージー州(NJ)">ニュージャージー州(NJ)</option>
                    <option value="ニューメキシコ州(NM)">ニューメキシコ州(NM)</option>
                    <option value="ニューヨーク州(NY)">ニューヨーク州(NY)</option>
                    <option value="ノースカロライナ州(NC)">ノースカロライナ州(NC)</option>
                    <option value="ノースダコタ州(ND)">ノースダコタ州(ND)</option>
                    <option value="オハイオ州(OH)">オハイオ州(OH)</option>
                    <option value="オクラホマ州(OK)">オクラホマ州(OK)</option>
                    <option value="オレゴン州(OR)">オレゴン州(OR)</option>
                    <option value="ペンシルベニア州(PA)">ペンシルベニア州(PA)</option>
                    <option value="ロードアイランド州(RI)">ロードアイランド州(RI)</option>
                    <option value="サウスカロライナ州(SC)">サウスカロライナ州(SC)</option>
                    <option value="サウスダコタ州(SD)">サウスダコタ州(SD)</option>
                    <option value="テネシー州(TN)">テネシー州(TN)</option>
                    <option value="テキサス州(TX)">テキサス州(TX)</option>
                    <option value="ユタ州(UT)">ユタ州(UT)</option>
                    <option value="バーモント州(VT)">バーモント州(VT)</option>
                    <option value="バージニア州(VA)">バージニア州(VA)</option>
                    <option value="ワシントン州(WA)">ワシントン州(WA)</option>
                    <option value="ウェストバージニア州(WV)">ウェストバージニア州(WV)</option>
                    <option value="ウィスコンシン州(WI)">ウィスコンシン州(WI)</option>
                    <option value="ワイオミング州(WY)">ワイオミング州(WY)</option>
                </select>
            </div>
        </div>

        <div class="conditions2">
            <div class="box">
                <div class="tooltip-container1">
                    <span class="tooltip-trigger">？</span>
                    <div class="tooltip-content">
                        州立大学は、州民以外の学生に対して通常の2~3倍の学費を設定していることに注意が必要です。また、私立大学の方が多くの奨学金を受け取れる傾向にあります。
                    </div>
                </div> 
                <div class="line-header2">
                    <h1><i class="fas fa-university"></i>私立/州立</h1>
                </div>
                <form>
                    <div class="form-group1">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="exampleRadios" id="radio1" value="option1" checked>
                            <label class="form-check-label" for="radio1">
                                指定しない
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="exampleRadios" id="radio2" value="option2">
                            <label class="form-check-label" for="radio2">
                                私立
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="exampleRadios" id="radio3" value="option3">
                            <label class="form-check-label" for="radio3">
                                州立
                            </label>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="conditions3">
            <div class="box">
                <div class="tooltip-container2">
                    <span class="tooltip-trigger">？</span>
                    <div class="tooltip-content">
                        州立大学は州外生向け料金、私立大学はNet Price（実質費用）を表示しています。
                    </div>
                </div> 
                <div class="line-header3">
                    <h1><i class="fas fa-dollar-sign"></i>年間授業料</h1>
                </div>
                <form>
                    <div class="form-group2">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="tuitionRadios" id="tuitionRadio1" value="option1" checked>
                            <label class="form-check-label" for="tuitionRadio1">
                                指定しない
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="tuitionRadios" id="tuitionRadio2" value="option2">
                            <label class="form-check-label" for="tuitionRadio2">
                                ~$9,999
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="tuitionRadios" id="tuitionRadio3" value="option3">
                            <label class="form-check-label" for="tuitionRadio3">
                                $10,000~$19,999
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="tuitionRadios" id="tuitionRadio4" value="option4">
                            <label class="form-check-label" for="tuitionRadio4">
                                $20,000~$29,999
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="tuitionRadios" id="tuitionRadio5" value="option5">
                            <label class="form-check-label" for="tuitionRadio5">
                                $30,000~$39,999
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="tuitionRadios" id="tuitionRadio6" value="option6">
                            <label class="form-check-label" for="tuitionRadio6">
                                $40,000~$49,999
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="tuitionRadios" id="tuitionRadio7" value="option7">
                            <label class="form-check-label" for="tuitionRadio7">
                                $50,000~$59,999
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="tuitionRadios" id="tuitionRadio8" value="option8">
                            <label class="form-check-label" for="tuitionRadio8">
                                $60,000~
                            </label>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="conditions4">
            <div class="box">
                <div class="line-header4">
                    <h1><i class="fas fa-user-friends"></i>学生数</h1>    
                </div>
                <form>
                    <div class="form-group3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="groupCheck33.1">
                            <label class="form-check-label" for="groupCheck33.1">
                                小規模(~2999人)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="groupCheck34">
                            <label class="form-check-label" for="groupCheck34">
                                中規模(3000人~9999人)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="groupCheck35">
                            <label class="form-check-label" for="groupCheck35">
                                大規模(10,000人~29,999人)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="groupCheck36">
                            <label class="form-check-label" for="groupCheck36">
                                超大規模(30,000人~)
                            </label>
                        </div>
                    </div>    
                </form>
            </div>
        </div>

        <div class="conditions5">
            <div class="box">
                <div class="tooltip-container3">
                    <span class="tooltip-trigger">？</span>
                    <div class="tooltip-content">
                        SAT（Scholastic Assessment Test）は、アメリカの大学入学に広く使用される標準テストです。総合スコアは400～1600点で、数学セクション（200～800点）と読解・ライティングセクション（200～800点）の合計です。多くの競争力のある大学では1200点以上、トップ大学では1400点以上が目安とされています。テストは年に7回実施され、何度でも受験可能です。
                    </div>
                </div>   
                <div class="line-header5">
                    <h1><i class="fas fa-chart-bar"></i>SAT総合スコア</h1>
                </div>
                <form>
                    <div class="form-group4">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="satRadios" id="satRadio1" value="option1" checked>
                            <label class="form-check-label" for="satRadio1">
                                指定しない
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="satRadios" id="satRadio2" value="option2">
                            <label class="form-check-label" for="satRadio2">
                                800~1000
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="satRadios" id="satRadio3" value="option3">
                            <label class="form-check-label" for="satRadio3">
                                1000~1200
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="satRadios" id="satRadio4" value="option4">
                            <label class="form-check-label" for="satRadio4">
                                1200~1400
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="satRadios" id="satRadio5" value="option5">
                            <label class="form-check-label" for="satRadio5">
                                1400~1600
                            </label>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="conditions6">
            <div class="box">
                <div class="tooltip-container4">
                    <span class="tooltip-trigger">？</span>
                    <div class="tooltip-content">
                        ACT（American College Testing）は、SAT同様にアメリカの大学入学で使用される標準テストです。総合スコア（Composite Score）は1～36点で、英語、数学、読解、科学の4つのセクションの平均値です。全国平均は約21点で、競争力のある大学では24点以上、トップ大学では30点以上が目安です。テストは年に6回実施され、多くの大学でSATとACTは同等に扱われます。
                    </div>
                </div> 
                <div class="line-header6">
                    <h1><i class="fas fa-chart-line"></i>ACT総合スコア</h1>  
                </div>
                <form>
                    <div class="form-group5">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="actRadios" id="actRadio1" value="option1" checked>
                            <label class="form-check-label" for="actRadio1">
                                指定しない
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="actRadios" id="actRadio2" value="option2">
                            <label class="form-check-label" for="actRadio2">
                                10~15
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="actRadios" id="actRadio3" value="option3">
                            <label class="form-check-label" for="actRadio3">
                                16~20
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="actRadios" id="actRadio4" value="option4">
                            <label class="form-check-label" for="actRadio4">
                                21~25
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="actRadios" id="actRadio5" value="option5">
                            <label class="form-check-label" for="actRadio5">
                                26~30
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="actRadios" id="actRadio6" value="option6">
                            <label class="form-check-label" for="actRadio6">
                                31~36
                            </label>
                        </div>
                    </div>    
                </form>
            </div>
        </div>

        <div class="conditions7">
            <div class="box">
                <div class="tooltip-container5">
                    <span class="tooltip-trigger">？</span>
                    <div class="tooltip-content">
                        難関大学ほど卒業率が高くなる傾向にあります。
                    </div>
                </div> 
                <div class="line-header7">
                    <h1><i class="fas fa-graduation-cap"></i>卒業率</h1>
                </div>
                <form>
                    <div class="form-group6">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="graduationRadios" id="gradRadio1" value="option1" checked>
                            <label class="form-check-label" for="gradRadio1">
                                指定しない
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="graduationRadios" id="gradRadio2" value="option2">
                            <label class="form-check-label" for="gradRadio2">
                                50%~
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="graduationRadios" id="gradRadio3" value="option3">
                            <label class="form-check-label" for="gradRadio3">
                                60%~
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="graduationRadios" id="gradRadio4" value="option4">
                            <label class="form-check-label" for="gradRadio4">
                                70%~
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="graduationRadios" id="gradRadio5" value="option5">
                            <label class="form-check-label" for="gradRadio5">
                                80%~
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="graduationRadios" id="gradRadio6" value="option6">
                            <label class="form-check-label" for="gradRadio6">
                                90%~
                            </label>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="conditions8">
            <div class="box">
                <div class="line-header8">
                    <h1><i class="fas fa-map-pin"></i>大学の立地</h1>    
                </div>
                <form>
                    <div class="form-group7">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="urbanCheck1" value="大都市">
                            <label class="form-check-label" for="urbanCheck1">
                                大都市
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="urbanCheck2" value="都市部近郊">
                            <label class="form-check-label" for="urbanCheck2">
                                都市部近郊
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="urbanCheck3" value="小都市">
                            <label class="form-check-label" for="urbanCheck3">
                                小都市
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="urbanCheck4" value="田舎">
                            <label class="form-check-label" for="urbanCheck4">
                                田舎
                            </label>
                        </div>
                    </div>    
                </form>
            </div>
        </div>
    </div>

    <div class="contents1">
        <div class="conditions9">
            <div class="box1">
                <div class="tooltip-container6">
                    <span class="tooltip-trigger1">？</span>
                    <div class="tooltip-content">
                        アメリカの大学では、2つ以上の分野を専攻することができます。また、副専攻として学ぶこともできます。文理の壁がほとんどないため、全く異なる分野を同時に学ぶことができます。
                    </div>
                </div>
                <div class="line-header7-major">
                    <h1><i class="fas fa-book-open"></i><strong>専攻</strong></h1>
                </div>
                <div class="options">
                    <label><input type="checkbox" name="major" value="health_professions"> 健康・医療 (3,479校)</label>
                    <label><input type="checkbox" name="major" value="business"> 経営学 (2,829校)</label>
                    <label><input type="checkbox" name="major" value="computer_science"> コンピューターサイエンス (2,407校)</label>
                    <label><input type="checkbox" name="major" value="education"> 教育学 (1,995校)</label>
                    <label><input type="checkbox" name="major" value="visual_arts"> 視覚・舞台芸術 (1,926校)</label>
                    <label><input type="checkbox" name="major" value="biology"> 生物学 (1,726校)</label>
                    <label><input type="checkbox" name="major" value="psychology"> 心理学 (1,697校)</label>
                    <label><input type="checkbox" name="major" value="sociology"> 社会学 (1,517校)</label>
                    <label><input type="checkbox" name="major" value="social_sciences"> 社会科学 (1,496校)</label>
                    <label><input type="checkbox" name="major" value="english"> 英語・文学 (1,487校)</label>
                    <label><input type="checkbox" name="major" value="mathematics"> 数学・統計学 (1,344校)</label>
                    <label><input type="checkbox" name="major" value="history"> 歴史学 (1,323校)</label>
                    <label><input type="checkbox" name="major" value="engineering"> 工学 (1,093校)</label>
                    <label><input type="checkbox" name="major" value="philosophy"> 哲学・宗教学 (898校)</label>
                    <label><input type="checkbox" name="major" value="agriculture"> 農業・農学 (761校)</label>
                    <label><input type="checkbox" name="major" value="law"> 法学・刑事司法 (640校)</label>
                </div>
            </div>
        </div>
    </div>

    <div class="search-button-container">
        <button class="cool-search-button" id="search-button"><i class="fas fa-search"></i> 条件で検索</button>
    </div>
</div>

<script>
// 大学名検索機能
document.getElementById('name-search-button').addEventListener('click', function () {
    const collegeName = document.getElementById('college-name-input').value.trim();
    if (collegeName) {
        // 大学名検索用のクエリパラメータを作成
        const queryString = new URLSearchParams({
            college_name: collegeName
        }).toString();
        
        // 検索結果ページにリダイレクト
        window.location.href = `/results?${queryString}`;
    } else {
        alert('大学名を入力してください');
    }
});

// Enterキーでも検索できるようにする
document.getElementById('college-name-input').addEventListener('keypress', function (e) {
    if (e.key === 'Enter') {
        document.getElementById('name-search-button').click();
    }
});

// 大学名検索と条件検索の干渉防止機能
document.addEventListener('DOMContentLoaded', function () {
    const collegeNameInput = document.getElementById('college-name-input');
    const nameSearchButton = document.getElementById('name-search-button');
    
    // 条件検索の要素を取得
    const stateSelect = document.getElementById('stateSelect');
    const conditionInputs = document.querySelectorAll('input[type="radio"], input[type="checkbox"]');
    const conditionSearchButton = document.getElementById('search-button');
    
    // 条件検索要素を無効化する関数
    function disableConditionSearch() {
        stateSelect.disabled = true;
        stateSelect.classList.add('disabled-field');
        
        conditionInputs.forEach(input => {
            input.disabled = true;
            input.parentElement.classList.add('disabled-label');
        });
        
        conditionSearchButton.disabled = true;
        conditionSearchButton.classList.add('disabled-button');
    }
    
    // 条件検索要素を有効化する関数
    function enableConditionSearch() {
        stateSelect.disabled = false;
        stateSelect.classList.remove('disabled-field');
        
        conditionInputs.forEach(input => {
            input.disabled = false;
            input.parentElement.classList.remove('disabled-label');
        });
        
        conditionSearchButton.disabled = false;
        conditionSearchButton.classList.remove('disabled-button');
    }
    
    // 大学名検索要素を無効化する関数
    function disableNameSearch() {
        collegeNameInput.disabled = true;
        collegeNameInput.classList.add('disabled-field');
        nameSearchButton.disabled = true;
        nameSearchButton.classList.add('disabled-button');
    }
    
    // 大学名検索要素を有効化する関数
    function enableNameSearch() {
        collegeNameInput.disabled = false;
        collegeNameInput.classList.remove('disabled-field');
        nameSearchButton.disabled = false;
        nameSearchButton.classList.remove('disabled-button');
    }
    
    // 大学名入力フィールドの監視
    collegeNameInput.addEventListener('input', function() {
        if (this.value.trim() !== '') {
            disableConditionSearch();
        } else {
            enableConditionSearch();
        }
    });
    
    // 条件検索の要素変更を監視
    function checkConditionInputs() {
        let hasConditionInput = false;
        
        // 州選択をチェック
        if (stateSelect.value !== '選択してください') {
            hasConditionInput = true;
        }
        
        // ラジオボタンとチェックボックスをチェック
        conditionInputs.forEach(input => {
            if (input.checked && input.value !== 'option1') { // デフォルト選択肢以外
                hasConditionInput = true;
            }
        });
        
        if (hasConditionInput) {
            disableNameSearch();
        } else {
            enableNameSearch();
        }
    }
    
    // 州選択の変更を監視
    stateSelect.addEventListener('change', checkConditionInputs);
    
    // 全ての条件入力要素の変更を監視
    conditionInputs.forEach(input => {
        input.addEventListener('change', checkConditionInputs);
    });
    
    console.log('Search interference prevention initialized');
});

// ポップアップ表示機能
function showStateRequiredPopup() {
    // 既存のポップアップを削除
    const existingPopup = document.getElementById('stateRequiredPopup');
    if (existingPopup) {
        existingPopup.remove();
    }

    // ポップアップ要素を作成
    const popup = document.createElement('div');
    popup.id = 'stateRequiredPopup';
    popup.innerHTML = `
        <div class="popup-overlay">
            <div class="popup-content">
                <div class="popup-header">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>州を選択してください</h3>
                </div>
                <div class="popup-body">
                    <p>検索を実行するには州を選択する必要があります。</p>
                    <p>州を指定したくない場合は「指定しない」を選択してください。</p>
                </div>
                <div class="popup-actions">
                    <button class="popup-btn popup-btn-primary" onclick="closeStateRequiredPopup()">
                        <i class="fas fa-arrow-left"></i> 戻る
                    </button>
                </div>
            </div>
        </div>
    `;

    // スタイルを追加
    const style = document.createElement('style');
    style.textContent = `
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease-out;
        }
        
        .popup-content {
            background: white;
            border-radius: 12px;
            padding: 0;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease-out;
        }
        
        .popup-header {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            padding: 20px;
            border-radius: 12px 12px 0 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .popup-header i {
            font-size: 1.2rem;
        }
        
        .popup-header h3 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .popup-body {
            padding: 24px;
        }
        
        .popup-body p {
            margin: 0 0 12px 0;
            color: #555;
            line-height: 1.5;
        }
        
        .popup-body p:last-child {
            margin-bottom: 0;
        }
        
        .popup-actions {
            padding: 0 24px 24px 24px;
            display: flex;
            justify-content: center;
        }
        
        .popup-btn {
            background: linear-gradient(135deg, #ffb366, #ff9933);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .popup-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 153, 51, 0.3);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
    `;
    
    document.head.appendChild(style);
    document.body.appendChild(popup);
    
    // ESCキーでポップアップを閉じる
    const escHandler = (e) => {
        if (e.key === 'Escape') {
            closeStateRequiredPopup();
            document.removeEventListener('keydown', escHandler);
        }
    };
    document.addEventListener('keydown', escHandler);
}

function closeStateRequiredPopup() {
    const popup = document.getElementById('stateRequiredPopup');
    if (popup) {
        popup.style.animation = 'fadeOut 0.2s ease-out';
        setTimeout(() => {
            popup.remove();
        }, 200);
    }
}

// 大学名入力と詳細条件の相互無効化機能
function setupMutualExclusion() {
    const collegeNameInput = document.getElementById('college-name-input');
    const conditionInputs = document.querySelectorAll('.form-select, input[type="checkbox"], input[type="radio"]');
    const nameSearchButton = document.getElementById('name-search-button');
    const conditionSearchButton = document.getElementById('search-button');
    const allConditionBoxes = document.querySelectorAll('.box, .box1');
    
    // 大学名入力時の処理
    collegeNameInput.addEventListener('input', function() {
        const hasValue = this.value.trim().length > 0;
        
        // 詳細条件を有効/無効化
        conditionInputs.forEach(input => {
            input.disabled = hasValue;
            if (hasValue) {
                input.classList.add('disabled-field');
                const label = input.closest('label');
                if (label) label.classList.add('disabled-label');
            } else {
                input.classList.remove('disabled-field');
                const label = input.closest('label');
                if (label) label.classList.remove('disabled-label');
            }
        });
        
        // 条件検索ボタンを有効/無効化
        conditionSearchButton.disabled = hasValue;
        if (hasValue) {
            conditionSearchButton.classList.add('disabled-button');
        } else {
            conditionSearchButton.classList.remove('disabled-button');
        }
        
        // 条件ボックスの見た目を変更
        allConditionBoxes.forEach(box => {
            if (hasValue) {
                box.style.opacity = '0.5';
                box.style.pointerEvents = 'none';
            } else {
                box.style.opacity = '1';
                box.style.pointerEvents = 'auto';
            }
        });
    });
    
    // 詳細条件入力時の処理
    function checkConditionInputs() {
        let hasCondition = false;
        
        // 州が選択されているかチェック
        const stateSelect = document.getElementById('stateSelect');
        if (stateSelect.value !== '選択してください') {
            hasCondition = true;
        }
        
        // その他の条件がチェックされているか確認
        const checkedInputs = document.querySelectorAll('input[type="checkbox"]:checked, input[type="radio"]:checked');
        if (checkedInputs.length > 0) {
            hasCondition = true;
        }
        
        // 大学名入力を有効/無効化
        collegeNameInput.disabled = hasCondition;
        nameSearchButton.disabled = hasCondition;
        
        if (hasCondition) {
            collegeNameInput.classList.add('disabled-field');
            nameSearchButton.classList.add('disabled-button');
            collegeNameInput.placeholder = '詳細条件検索中は大学名検索は使用できません';
        } else {
            collegeNameInput.classList.remove('disabled-field');
            nameSearchButton.classList.remove('disabled-button');
            collegeNameInput.placeholder = '例：Harvard University, Stanford University...';
        }
    }
    
    // 全ての条件入力にイベントリスナーを追加
    conditionInputs.forEach(input => {
        input.addEventListener('change', checkConditionInputs);
    });
}

// ページ読み込み時に相互無効化機能を設定
document.addEventListener('DOMContentLoaded', function() {
    setupMutualExclusion();
});

// 検索機能
document.getElementById('search-button').addEventListener('click', function () {
    const stateValue = document.getElementById('stateSelect').value;
    
    // 州が選択されていない場合はポップアップを表示
    if (stateValue === '選択してください') {
        showStateRequiredPopup();
        return;
    }
    
    const formData = {
        state: stateValue,
        privateorpublic: document.querySelector('input[name="exampleRadios"]:checked')?.nextElementSibling?.innerText.trim(),
        tuition: document.querySelector('input[name="tuitionRadios"]:checked')?.nextElementSibling?.innerText.trim(),
        students: Array.from(document.querySelectorAll('.form-group3 input:checked')).map(cb => cb.nextElementSibling?.innerText.trim()),
        sat_score: document.querySelector('input[name="satRadios"]:checked')?.nextElementSibling?.innerText.trim(),
        act_score: document.querySelector('input[name="actRadios"]:checked')?.nextElementSibling?.innerText.trim(),
        graduation_rate: document.querySelector('.form-group6 input:checked')?.nextElementSibling?.innerText.trim(),
        urbanicity: Array.from(document.querySelectorAll('.form-group7 input:checked')).map(cb => cb.value),
        major: Array.from(document.querySelectorAll('input[name="major"]:checked'))
            .map(cb => cb.value)
            .filter(value => value !== "")
    };

    // majorが選択されていない場合の処理
    if (formData.major.length === 0) {
        formData.major = "未選択";
    }

    // クエリ文字列を作成
    const queryString = new URLSearchParams(formData).toString();

    // クエリ文字列を使ってリダイレクト
    window.location.href = `/results?${queryString}`;
});
</script>